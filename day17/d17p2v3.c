#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include <assert.h>
#include <stdbool.h>
#include <stdint.h>

//#define BUF_HEIGHT 1000000
#define BUF_HEIGHT 1000000
#define TOTAL_ROCKS 1000000000000LL
//#define TOTAL_ROCKS 2022

typedef char row_t[9];
typedef int64_t potato;

typedef struct {
	potato x;
	potato y;
} cords_t;


// 3
// 2
// 1
// 0# # # #
//  0 1 2 3
// hieght = 2
typedef struct {
	char outline[4][4]; /* y, x */
	potato hieght;
	char id;
} rock_t;


const rock_t flat_rock = {
	{"####","    ","    ","    "},
	1,
	'-'
};
const rock_t plus_rock = {
	{" #  ",
	 "### ",
	 " #  ","    "},
	3,
	'+'
};
const rock_t L_rock = {
	{"### ",
	 "  # ",
	 "  # ","    "},
	3,
	'L'
};
const rock_t I_rock = {
	{"#   ",
	 "#   ",
	 "#   ",
	 "#   "},
	4,
	'|'
};
const rock_t cube_rock = {
	{"##  ",
	 "##  ",
	 "    ",
	 "    "},
	2,
	'C'
};

const bool do_debug_printing = false;
//const char* jets = ">>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>";
const char* jets = ">><>>><<<>>><<>>>><<<>>>><<><>>><<<<>><<<><<<>><<<<>><<>>>><<>><<<><>><><<<>><<<<>>>><<>>><><<>>><<><<<<>>><<>>><>><<<<>><<<<>><<><<>>>><<<>>><<>>>><<<><><><<>>>><<>><<>><>>><<<>><<>>><<<<>>><><<<><<<<><<<<><<<<>>>><>>>><<<>>>><>>><>>><<<<>>><<<<><<<<>>><>>>><<>>>><<<<>>>><<<><<><<<>>>><>>><<<<>>><<<><<>>><<<<>>>><<<>><>><>><<<<>>>><><>>>><<<<>>>><<><<<<><<<<>>>><<>>><<>><<<><<<><<<<>>><<<>>><<>>>><<<>>>><>>>><<<>><<<>>><<<<>>><<>>><<<<>><<>>>><><<<<>>><><>><>><<<>>><<<>><>>>><<<<>>><<<<>>><<<<>><<<<>>><<>>>><>>>><<<>>><<<<><<<>><><<<<>>>><<<>><<<<>>>><<>><<<><<<<><<<<>>>><<<>>>><<>><><<<>><<>>>><<<>><<<>>>><>>>><><<<<><><<>>><<<>><<>>>><<<>><<>>>><<>>><<<<><<<><<>><<<>><>><<<>>>><><>>>><<<><>>>><<<>>>><<>><<>><<<<><<<>>><<<>><<<<>>><>><<>>><<<<>>>><<<><<><<>><<<<>>><<><<<<>>><>>><<>>><<>><<><><<>>>><<><<<<>>><<<<>>><<<<>>>><<>>>><>><<<<>><<<<>>><>><<<>>>><<><<<>>>><<>>><<>><<<<>><<<><<<<>>><<><<<<>>>><<>>><<<>>>><<<>><<<>>>><>>>><>>><>>><>>><>>><<>>><<><<<<>><<>><<>><>>>><<<<>>><<><<>>>><<<><<>>><<><<<>>><<>><>><<><<<>>><<>>>><<<<>><<><<>><>>>><><<<<>>>><<><<><<>><<<<>><<<><<>>>><<<<>>><>><<>>><>><<<<>><<>>><><<<>>><<<>>>><>>><<<>>><><<<><<<><<<>><>>>><<><<>>><<<<>>>><<>>><<>>>><<<<>>><<>><<<<>><<<<>>><><<><<<>><<>>><><>>>><<<><>>>><<>>>><<<>>><<>><>>>><>><<>>>><<<<>><<<>><<>><>>><<<<>>>><><<<<>>><<<<>>><>>><<<<>>>><>>><<<<>>>><><<>>><<><<<>>><<<>>><>>><<>>>><><<<<>><<>>>><<>>>><<>>><<>><<><>>>><<>>>><<<<>>><<<<><<<<><<>>><<<>><<<>>>><<><<<<>>>><<<<>>>><<<>>><><<<>>><<<>><<<>><<<<>>><<>>><<>><<<>>>><<<<>><><><<<>>>><<<>>><<>>>><<>>>><<<><><<<>>>><<<>>><>><<<>>>><<<<><<<<>>>><<<>>><<>><>>><<>><>>>><<>>><<>><<<>>><><<<>><<<>><><><<<<><<<<><<<<>><>>>><<>>><>><<<>>>><<>><<<>>><<>><<<>>><>>><<<>>>><>><<>><<<>><>><<>>>><>>>><<<><<<<>><>>>><>>>><>>><<<><<>>>><<>>>><<<<><<>>>><<<<><<>>>><<>>><<>><<<>><<>>><><<<<><>>>><>>><<<>><<<<><>>><<<<>>><>>>><><<>>>><<<<>>>><>><>>>><<<<><<<<>>>><>>>><<<>>><><<><<>>>><<<>><<<<><<<<>>><<>>><<<<>>>><<<<>><><<>>><>><<<>>><<>><<>>><><<>><<<<>>>><<<><<<<>>>><<><<<>>>><<<<><<>>>><>>>><<<<>>>><>>>><<<>><><<<>><<<<><<<>><>>><<<<>><<<<>>><<>><>>><><<<<>>><<><<<<>>>><>>><>><<<<><<<>>><>><<<>><<<><<>><>><<<<>>><<<>>><><>>>><><>><<<>>><<><<>>>><<<>>>><><>>><<<><<>><><<<><<>>>><<<>><<><>><<<>><<<<>>><<>>><<>><<<>><><<>>><<>>>><<<>><>><<>>>><<<>>>><<>>><<>>>><<>>><>><>><<<>>><<>>>><>><<>>>><<<<>><<<><<<<>><>>><<>>><<<<><<<>><><<<<>><<><<<>><<<>><>>>><<><>><<<<>>>><>>>><<><><<<<>>>><<<>>>><<<>><<><<<<>>>><<<<>><<<>>>><<<<>>>><<>><<<<>>>><>>><<><<<>>>><<>>><>>>><>><>><>><<>>>><<<><>><<<>>>><<<<>>>><<<<><<<>><><<><<>>>><<<<>><<<<>><><<<<>>>><<<<>><><<>>>><<>><<>>>><<><<><<<><<>>><<><<<><<><<<>>>><<<<>>><><<<<><<>>>><>><<<>>>><<>>><<>>><>>><>>>><<<>>><<>><<>>>><<<>>>><<<<>><<<>><<<><<<><><<<<>>><<>>><<<>><<>>>><><<<<>><<<<>>>><<<<>>><<<<><<>><<>>><<<<><<<><<<<>><<<>><<<><<<>><<<>><<<<>>>><<<>>><>>><<<<>><<<>><<<>>><>>>><<<<>><<<<><<><>><>><<><<<>>>><<<<><<>>><><<<<>><<<>>>><<<<>>><<>>>><<>>>><<<>>><<>>>><<>><>>><<><<<<>>><<<<>><<<<>><<<<>>><<<<><<><><<<><>><<<<>><<<>>>><<<<>>>><<<<>>><<><<><>><<>><<><<<<><<><>><>><<<>><<>>><>>>><<<><<<>><<<>>>><<>>><<>>>><<<<>>><<<<>><<<<>>>><<>><>>><><>><<<<>>>><<<>><<>>><<<>>>><>>>><<<<>>><<>>>><<<><<<<>>>><<><>>>><<<>>>><<><<<<>><<<<>><<><<<<>>>><<<>>>><<<<>><<>><>><<><<>>>><<>>>><<><<>><<<<>>><<<<>>>><>>><<<><>>>><<<>><<<>>><<>>><<<<>>>><><<<<>><>><<>>><<<>>>><<<<>><><>><<<<><<<<>>><<<<>>>><<<>>><<<<>>>><<>>>><<<><<>>><<>>><<<><>><>>>><<<<>>><<<<>>>><<<>><<>>><>>>><<<<>>><<>>>><<<>>>><<<><<<<>><>>><<><><<<>><<<>>><<><<<<>>>><<<<><<<<><<<>>>><<<<><<>><<<<>><<>>>><>><<<<><>>><<<><<<><<>>>><>><<<><<<<><<>>>><<>><<<<>>>><<>><<<<>><<<>><<><>>><>><<><<>>><<><<<<>><><<>>><<<>>><>>><<>>><<<><<<>>>><<<<>>><<<<>>>><<<<>>><<<<>>><<<>>>><<<>><<>><<<<>>>><<<<><<>>>><<>>><<<><<><<>>><<<<>>><<<<><<<>>><>>><<<>>>><>>><<>>><<>>>><>>><<<>>><<<><<<<>><<><<<>>><<<>>><<>>>><<><<>>><<><<<<>>>><<<>><<<<>>><<<<>>><>>>><><<<>><<<<>>>><>><<<>>><<>>>><<<<><<<>>><<<>>><><>>>><>><<<>>><<<<><<<>><<<<>>>><<<<><><<>><><>><<<><<<<><<<>>><<>>>><<<>>><<>>><<>>><<>>><<<>>>><<><<>>>><<<<>>>><<<>><<<><<<<>>><<>>>><<<<>>>><<><<>>><<>><<<>>>><<<>>>><>><<<<>>>><>>>><>>><<<<>><<<<>>><<<><<<>>><<<>><<<>><<<><>>><>><<<<>><<<<>>>><<>><<>><<<>>>><<<>><<<<>>><<>>>><<<<><><<<>>><>>><<<<>>><<>>><<<<>><<<>>><<<<>><>>>><<>>><><<<>>>><<<<>>>><>><<<>>>><<<>>>><>><>>><<<>>>><><>>>><<<<><>>><<<>><<<<>>><<<>>><<><<>>>><<<><<<><<<>>><<<><>><>>><><<<<>>><<<<>>><>>>><<<<>>>><>>><<<>>><>>><>>><<<><<><<><<<<><<<<>>>><<<>>>><<<>>>><<<<><<<><<>>>><>>>><<<>><<<>>><<>><<<<><><>><<><<<>>><<<<>>>><><<><<<>><>>>><<<<>>>><<>>><<<<><<<>>>><<>>><<<<>>>><<<<>><<>>><<<>>>><<<<>><<<><<>><>><<>><>><<>>><<>>>><<<<>><<><<<><<<<>><<<<>><>>><><<<<>><<>><<<<>><<<>>><><<<><<<>>><<><<<<>><<<<>>><<><<>><><<<<><<<>><<<><<<<>>><<<<><<>>><<<>>><<<>><<<<><<>>>><<<<>>><<<<>>><<<<><>>>><<><>><>>><<>>>><><<<><><>>><<<<><<><<<>>><>>><><<<><<>><>>><<<<>><<<>>><<>>>><<>>>><>>>><<<>>><>><<<<>><<<>>><<<>>>><>>><<><<><<<<>>>><<<><>>>><<>>>><<<>>>><<>>>><>><<<<>>>><<><<<<>>>><<>><<<>>>><>><<><<<<>><>>>><<<<>><<>>><<<<>><<<<>>><<<<>>><<>><<<<><><<<>>>><<>>>><<<>>><<<><<<>>><<<>>><<>>><><<<>>><<>><<>>>><><<<<>>><<<>><<><<>>>><<<><<><<<<>><><><<>>>><<<<>>><<<<>><<><<><>>>><<<>>><<<>>>><<<>>><<<<>>>><<<<>>><<<<><<><<<<>>><>>><<<<><>>><>>>><<>>><<>>>><<<<>>><<<>>><<<<><<>>>><>>><<<>>><<<<><><<>>><<<>>><<<>><<<>>>><<<><<>>>><<>>><>><<<>>>><<>>><<>><<<>>>><<><<<<>>>><<>>>><<<<><<>>><<>><>>>><<<>>><<<><<<><<<>>>><<>>>><<>>>><<<<>>><><<<>>>><<<<>><<>>>><><>><<<>><<<<>><>>>><><<<>>>><>><<<<>>><<<<>><<<>><<>>>><>>><<<>>>><>>>><>>>><<>><<<<>>>><<><<<<>>>><><<><>><<<>>><>>>><<>>><<<>><<<>>>><<><<<<><<<>>>><<<<>><<>><<>><<>>>><>>><<<>>><<<><<<<>>>><>>><>><<>>>><>>>><<<<>><<<>>>><<<>><<<<>>><<>><<><<>>>><>><>>><><<>><<><<><<<>>><<<>><>><<<<>>><<<<>>>><<<<><>>>><<>>>><<<<>><<<<>><<<>>>><>><<<>>><<<<>>>><<<<>>><<<><><<><<<<>><<<<><<>><<<<>>>><>><>>>><<<>><<>><<<<>>><<<<><<<><>><>>>><>><>>><<>>>><<<<>><<>>>><<<<>>><<<>><>><<<<>>><<<<>>><<><<<<>>>><<<<>>><<<>>><>><<<><<>>>><<>><<<<>><<<>><><<<>>><<<>><<<<>>>><><<<>>>><<<<>><<<<>>>><<<<>>><<<><>>><<<<>>><>><>>><<>><<><<<>>>><><<<<>>>><<<<>>><<<<>>><<>><>><<>><<<>>><<<<>>><<>>><<<>>><<<<><>>>><>>><<<<>>><<<><>><<>>><<>><<>>>><>>><<<<>><<>><<<>><><<><>><<<<>>><<<<><<>>><>>>><<>><<<>><<>>><<>>>><<<><<<><<<<>><<<>><<>>><><>><<<><<><>>>><<<>>>><<<>>>><>><<><<<<><<<<>>>><<<>>><<><<<<>>><<<>><<>><>>><<>><<<>>>><><><<<>><>>>><<>>>><>>><<<>><>>>><<<<>><<<<><<<<>><<<<>><<<<>>>><<<<>>><<<><<<<>>>><<>>>><<<>><<>>>><<<>>><<<>>><<>><<<>><<<<><<<>><><>>><<><<>>>><<>>><>>><<<>><<><<><<<>>>><<<<><<<><<<<>><<<<><<<>><<>>><<<<>>>><<<>>>><<><<>>>><><<<>><><>>>><<<<>>><><><<<>>>><<<><<<><<>>><<>><<<>><<<>>>><<<>><<>><<<<>><<>>><><<<<><<><<>><<<>>>><<<><<<>>>><<>><<<<>><<<<><<<>>>><<<<>><<<><<<<>>>><>>>><<<><<><><<<><<<>>><<>>><<<<><<>>>><<<>>><<<<>>><<><<>><<>>>><><<<<>>>><><>>><<<>>><<>>><<<<>>>><<<<>><<<>>>><>>><<>>>><>><<<>><<<><<<<>>><>><<<>><<>>>><<><<<>><<><<<><<<<>>>><><<>>>><<<>>><<<<>><>>>><<>><>>><<<<>>><<<<><<<<>><<<<>><<<><<<<><>>>><><<<>>>><<>><<>>><><<<>>><><<<<><>><<<>>>><<><<<<>>>><<<><<<>>>><>>><<<><<<<>>>><<<<><>>><<<>>><<>><<><<<<>>><<<<>>><><>>><<<<><<>>><<>><<<><>><<<<>>><<>><<<>>><<<<>>><<<>>><<<><<<<><<<<>><<><<<>>><<>><<<>><><<<>>>><<><<>>><<<>>>><<>><<<<>>>><>>><<<<><><<<<>><>>><<<>>><<<>>><<<>><>>>><>>><<<<><<<>><>>>><<<>>><><<><>>><<<>>>><>><<<>><<<<><>><<>>><<<><>>><<<>><><<<<>>>><<<><<<>><>><<<>>><>>>><<<>>><<>>>><<<>>>><>>>><<<<>>><<><<>><<<<>>>><>>><<<><<<<>>>><<<>>><<>>><<<>><<<<>>><<<<><>>>><<>>>><<>>><<>><<<<>><<<>>><<<>>>><<<<>>>><>>><><<>>>><<<>>><<><><<>>>><<<>>>><<>><<<<>><<<<>>><<<><<<><<><<<><<<>>>><<<<>>><<<<>><<<<>><<<<>>>><<<><<>><<>>>><<>>><<<<>>>><<<>>>><><>>>><<<<>>>><<<<>><<<>>><<<<>><<<>>><<<<><<<><<<<>>><<<>>><<>>>><>>>><<<<><<<<>><<>>>><<<<><>>><><<>>><>>>><<<>>>><<<<><<><<<<><><<<<><<<<>>>><<<<>>><<<>>><<<<>>>><<<<>><>>>><<>><<>><<>><<<>><>>><>><>><<><>><<<>>><<<>>><>>><<>><<<><>><<>><<<>><<<>><>>>><>>>><<<>><>>>><<>>>><>><<>>>><>><<<<>><<>>><<<<>>><<>><<<>>>><<>><<>><<<<><<<><<<<>>><>>><<>><>><<<>><<<>>><>>>><<>>>><>>><<>>>><><>><<>><<<<><<>>>><<<><<>>>><<>><<<>>>><>><<>>>><>>><><><<<><>><<><>><<<><<<<>>><<>>>><><<>>>><<>>><<>>>><<<<>>>><>>><><>><>>><><<<<>>>><<<<>>><<<<>>>><<>>>><<>>>><<<>>>><<<<>>>><<<>>><<<>>>><<<<><<<>>><<<<><<>>><<>>>><<<<>><>>>><<><><<<<><<<>>><<<>><<><<<<>>>><<>><><<<>>>><<<>>><<<<>>><>>><<<<>>>><<<<>>><<><<>>>><<<><>>>><<<<>>><>><>>>><<<<>><<>>>><>><<<>><<>>><<<<><<<>>><<<><>>><<<><><<<>>><<<>>>><><>>><<<><<<<>>><>>><>><<<><<<<>>><>>>><<<<>>><<<<>>><<<>><<>>><<<<>>>><<>><<<<>><>>><<<>><>><<<<><<<<>><<<><<<>>>><><>><<>>>><<<<><<<>>>><<<<>><<>>><<<><>>>><<<<><><>>>><<>>><<<>>><<<<>>>><<>>><><<<>>><<>>>><<<<>>><<<<>><><<<<>>>><<<<>><<<><<><<<<>>><<<<><<>><<<>>><<<>>><><>>><<<>>><<>><<<>>><<<<>><>>><>>>><>>><<<<>>><>>><<><<<<>>>><<<<>>><<<<>>>><<<>>><>>><>><<<>>>><>>><<<<>>>><<<<>>><<<<>>>><<<>><<<>><<>><>><<<<>>><>>>><<<<>><<<<><<<<>>><>><>><<<>>>><<<><>>><<><<<<>>>><<<<>><<<<>>>><<<>><<<><<<>>>><<<<><<<>><><<<<>>>><<>>>><<<<>>><<>>><>>><<><<<<><<<><<><<<<>>><>>>><<<<><<<<>>>><<<<>>><<>>>><<>>>><>>>><<><<<<><>><<>>>><<<>>><<<<>><<>>><<<>>>><<<>><<<<>><<<><>>><><<<>>><<<>>><<<><<>><<<>><<<>>>><<>><<>>><<<>><>>>><<>>><<<<><><<<>>><<>>><>><<<<>>><<<>>><<>><<<<><<>>><<>>>><<>><>>><<<<><<<<><<<><<<<>>><<>>><<<<>>><<>>>><>>>><<<<>>>><<<>><<<>><<<><>><>>>><<<><<<>>><>>><<<><<>>>><>>>><>>><><<<>>>><<<>>><>><<>>>><<>>><<>>>><<<<>>>><<>>>><<>>><<<>><<<<>>><><<<>>><<<><<<><<<>>>><>>>><><<>>>><<<>><><<<<>>>><<<<>>><<<<>><>><>>>><<<><><>>><<<>>><<<>>>><<>>>><<<<>>><><<>>>><>>><<><<<>>>><<<>>>><<<>>>><>>><>>>><>>><>>><>>><<<<><>>><<<>>><>><<<>>><>>>><<<<>>><<>>>><<><<>>><<><<<<>>><<>>><<><<<<>>><<>><<>>>><<<>>>><<<><><<<<><<<><<><>><<<<>><<>><<<<>><<>>>><<<>>>><<<<>>>><>>>><<<<>><<<>>>><<>>>><<><<>>><<<<><>>>><<<>>>><<<<><<<<>><>>><<<>>><<<<><>><<<><<>>><<>>>><<<><<<>><<<>>><<<>>><<<<>>><<<<>>>><<<>>>><<<><<<<>><<<<>>><<<>><<<>>><>>><<>><>>>><>>>><<<>>><<<>>>><<>>><<<><><<<>>>><<<><<<<>>><<<>>>><><<>>><<>>><<<>>><<<<>>><<<>>>><<<>>>><>>>><<<><<><>>>><<>>>><<<<>><<<><<<<>>><>";
potato jets_period;

potato max(potato a, potato b) {return a > b ? a : b;}

void save_memory(row_t* chamber, potato highest_rock_circ, row_t* memory);
/// @return weather the chamber is the same thing as saved to memory
bool recal_memory(row_t* chamber, potato highest_rock_circ, row_t* memory);

bool floor_is_visible_from_above(row_t* chamber, potato y_above);

/// @brief fall rock potatoo chamber
/// @return highest rock after fall
potato fall_rock(row_t* chamber, potato highest_rock, potato* jet_phase, const rock_t rock);
void print_chamber(row_t* chamber, potato ystart);

int main() {
	jets_period = strlen(jets);
	row_t* chamber = (row_t*)calloc(BUF_HEIGHT, sizeof(row_t));
	potato highest_rock_circ = 0;
	potato highest_rock_phantom = 0;
	potato jet_phase = 0;
	potato rock_phase = 0;


	row_t* memory = (row_t*)calloc(30, sizeof(row_t));
	int jet_phase_mem, rock_phase_mem;
	int64_t hight_mem;
	bool memorey_avlaible = false;

	for (potato i = 0; i < BUF_HEIGHT; i++){
		strncpy(chamber[i], "|       |", 9);
	}

	/* Do stuff */
	potato phantom_rock_count = 0;
	for (potato rock_count = 0; rock_count + phantom_rock_count < TOTAL_ROCKS; rock_count++) {
		assert(highest_rock_circ < 900000);
		rock_t current_rock;
		switch (rock_phase)
		{
		case 0:
			current_rock = flat_rock;
			break;
		case 1:
			current_rock = plus_rock;
			break;
		case 2:
			current_rock = L_rock;
			break;
		case 3:
			current_rock = I_rock;
			break;
		case 4:
			current_rock = cube_rock;
			break;
		
		default:
			assert(false);
			break;
		}


		highest_rock_circ = fall_rock(chamber, highest_rock_circ, &jet_phase, current_rock);
		rock_phase = (rock_phase+1) % 5;
		
#define MEMORY_SNAPSHOT_MILESTONE 2000
		if(rock_count == MEMORY_SNAPSHOT_MILESTONE) {
			printf("AAAA\n");
			save_memory(chamber, highest_rock_circ, memory);
			printf("BBB\n");
			jet_phase_mem = jet_phase;
			rock_phase_mem = rock_phase;
			hight_mem = highest_rock_circ;
			memorey_avlaible = true;
		} else if (memorey_avlaible && rock_count> 4000) {
			if(recal_memory(chamber, highest_rock_circ, memory) && jet_phase_mem == jet_phase && rock_phase_mem == rock_phase ) {
				for (int i = 0; i < 30; i++)
				{
					printf("%.9s\n", memory[i]);
				}
				printf("\n");
				
				int64_t rock_n_diff = rock_count - MEMORY_SNAPSHOT_MILESTONE;
				int64_t hieght_diff = highest_rock_circ - hight_mem;
				int64_t number_of_phantom_cycles = (((TOTAL_ROCKS - rock_count) / rock_n_diff) -100);
				phantom_rock_count = number_of_phantom_cycles * rock_n_diff;
				highest_rock_phantom = hieght_diff * number_of_phantom_cycles;
				memorey_avlaible = false;
				printf("rd %lld\n", phantom_rock_count +rock_count );
			}
		}
	}
	
	//print_chamber(chamber, highest_rock_circ+3);

	printf("Tower hieght: %lld\n", highest_rock_circ + highest_rock_phantom);
	return 0;
}



//(((((((((((((((((((((((((((((((((((((((((((.)))))))))))))))))))))))))))))))))))))))))))


void print_chamber(row_t* chamber, potato ystart) {
	for (potato y = ystart; y >= 0; y--) {
		for (potato x = 0; x < 9; x++) {
			printf("%c", chamber[y][x]);
		}
		printf("\n");
	}
	
	printf("+-------+\n");
}

void print_chamber_rock(row_t* chamber, potato ystart, const rock_t rock, cords_t rock_pos) {
	for (potato y = ystart; y >= 0; y--) {
		for (potato x = 0; x < 9; x++) {
			char c = chamber[y][x];

			if(x >= rock_pos.x && x < rock_pos.x +4
			&& y >= rock_pos.y && y < rock_pos.y +4) {
				if('#' == rock.outline[y -rock_pos.y][x - rock_pos.x]) 
					c = '@';
			}
			
			printf("%c", c);
		}
		printf("\n");
	}
	
	printf("+-------+\n");
}


bool is_coliding(row_t* chamber, const rock_t rock, cords_t rock_pos) {
	if(rock_pos.y < 0)
		return true;

	bool res = false;

	for (potato x = 0; x < 4; x++) {
		for (potato y = 0; y < 4; y++) {
			if(rock.outline[y][x] == '#') {
				res = res || chamber[rock_pos.y +y][rock_pos.x + x] != ' ';
			}
		}
	}

	return res;
}

void place_rock(row_t* chamber, const rock_t rock, cords_t rock_pos) {
	assert(!is_coliding(chamber, rock, rock_pos));

	for (potato x = 0; x < 4; x++) {
		for (potato y = 0; y < 4; y++) {
			if(rock.outline[y][x] == '#') {
				chamber[rock_pos.y +y][rock_pos.x + x] = '#';
			}
		}
	}
	
}


potato fall_rock(row_t* chamber, potato highest_rock, potato* jet_phase, const rock_t rock) {
	cords_t rock_pos = {/*x*/ 3, highest_rock + 3};

	if(do_debug_printing) {
		printf("%c Begins falling: \n", rock.id);
		print_chamber_rock(chamber, highest_rock + 6, rock, rock_pos);
		printf("\n");
	}
	assert(!is_coliding(chamber, rock, rock_pos));

	while (true) {

		{ /* get pushed by the jet stream if posible */
			char push_direction = jets[*jet_phase];
			*jet_phase = (*jet_phase +1) % jets_period;

			cords_t attempted_position = rock_pos;

			if(push_direction == '<') {
				attempted_position.x--;
			} else {
				assert('>' == push_direction);
				attempted_position.x++;
			}

			if(! is_coliding(chamber, rock, attempted_position)) {
				rock_pos = attempted_position;
			}


			if(do_debug_printing) {
				printf("%c jet: \n", push_direction);
				print_chamber_rock(chamber, highest_rock + 6, rock, rock_pos);
				printf("\n");
			}
			assert(!is_coliding(chamber, rock, rock_pos));

		}
		{ /* fall down */
			cords_t attempted_position = rock_pos;
			attempted_position.y--;

			if(is_coliding(chamber, rock, attempted_position)) {
				place_rock(chamber, rock, rock_pos);
				
				if(do_debug_printing) {
					printf("Rock comes to rest\n");
					print_chamber(chamber, highest_rock + 6);
					printf("\n");
				}
				return max(rock_pos.y + rock.hieght, highest_rock);
			} else {
				rock_pos = attempted_position;

				if(do_debug_printing) {
					printf("Rock falls 1 unit\n");
					print_chamber_rock(chamber, highest_rock + 6, rock, rock_pos);
					printf("\n");
				}
			}
		}
	}
}

bool floor_is_visible_from_above_in_row(row_t* chamber, potato y_above, int row) {
	for (size_t y = 0; y < y_above; y++) {
		if(chamber[y][row] == '#')
			return false;
	}

	return true;
}


bool floor_is_visible_from_above(row_t* chamber, potato y_above) {
	bool res = true;

	for (int x = 1; x < 8; x++) {
		res = res && floor_is_visible_from_above_in_row(chamber, y_above, x);
	}
	
	return res;
}

void save_memory(row_t* chamber, potato highest_rock_circ, row_t* memory) {
	highest_rock_circ++;
	for (int i = 0; i < 30; i++){
		memcpy(memory[i], chamber[i+highest_rock_circ-29], sizeof(row_t));
		printf("%.9s\n", memory[i]);
	}
	printf("\n");
	
}

bool recal_memory(row_t* chamber, potato highest_rock_circ, row_t* memory) {
	highest_rock_circ++;
	bool res = true;

	for (int i = 0; i < 30; i++) {
		res = res && (0 == strncmp(memory[i], chamber[i+highest_rock_circ-29],9));
	}

	return res;
}